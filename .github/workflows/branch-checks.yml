name: Branch Gatekeeper

on:
  pull_request:
    branches:
      - main
      - develop
      - release/**
      - feature/**
      - hotfix/**
      - bugfix/**
      - chore/**
      - docs/**
      - test/**
      - refactor/**
      - dependabot/**
      - renovate/**
      - codex/**
  push:
    branches:
      - main
      - develop
      - release/**
      - feature/**
      - hotfix/**
      - bugfix/**
      - chore/**
      - docs/**
      - test/**
      - refactor/**
      - dependabot/**
      - renovate/**
      - codex/**

permissions:
  contents: read

jobs:
  branch-naming:
    name: Validate branch naming conventions
    runs-on: ubuntu-latest
    steps:
      - name: Check branch name pattern
        env:
          BRANCH_NAME: ${{ github.head_ref || github.ref_name }}
        run: |
          echo "Validating branch name: $BRANCH_NAME"
          if [[ "$BRANCH_NAME" =~ ^(main|develop|release\/.+|feature\/.+|bugfix\/.+|hotfix\/.+|chore\/.+|docs\/.+|test\/.+|refactor\/.+|dependabot\/.+|renovate\/.+|codex\/.+)$ ]]; then
            echo "Branch name '$BRANCH_NAME' complies with the required conventions." | tee -a "$GITHUB_STEP_SUMMARY"
            exit 0
          fi
          {
            echo "### Branch name validation failed"
            echo "- Branch: \`$BRANCH_NAME\`"
            echo "- Allowed patterns: \`main\`, \`develop\`, \`release/*\`, \`feature/*\`, \`bugfix/*\`, \`hotfix/*\`, \`chore/*\`, \`docs/*\`, \`test/*\`, \`refactor/*\`, \`dependabot/*\`, \`renovate/*\`, \`codex/*\`"
          } >> "$GITHUB_STEP_SUMMARY"
          echo "Branch name '$BRANCH_NAME' does not match any allowed pattern." >&2
          exit 1
